---
import Layout from "../layouts/Layout.astro";
import { supabase } from "../lib/supabase";

const { data: posts, error } = await supabase
	.from("posts")
	.select("*")
	.eq("published", true)
	.order("published_at", { ascending: false });

if (error) {
	console.error("Error fetching posts:", error);
}
---

<Layout title="Project Overlord">
	<div class="space-y-12">
		<section class="text-center space-y-4">
			<h1 class="text-4xl md:text-6xl font-bold tracking-tight">
				Welcome to Project Overlord
			</h1>
			<p class="text-lg text-zinc-400 max-w-2xl mx-auto">
				Minimalist thoughts, maximum impact.
			</p>
		</section>

		<section class="space-y-8">
			{
				posts && posts.length > 0 ? (
					<div class="grid gap-8">
						{posts.map((post) => (
							<article class="group border border-zinc-800 rounded-lg overflow-hidden hover:border-zinc-700 transition-colors">
								{post.cover_image && (
									<a
										href={`/posts/${post.slug}`}
										class="block aspect-video overflow-hidden"
									>
										<img
											src={post.cover_image}
											alt={post.title}
											class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
										/>
									</a>
								)}
								<div class="p-6 space-y-3">
									<a
										href={`/posts/${post.slug}`}
										class="block"
									>
										<h2 class="text-2xl font-bold group-hover:text-zinc-300 transition-colors">
											{post.title}
										</h2>
									</a>
									{post.excerpt && (
										<p class="text-zinc-400">
											{post.excerpt}
										</p>
									)}
									<div class="flex items-center justify-between text-sm text-zinc-500">
										<time datetime={post.published_at}>
											{new Date(
												post.published_at,
											).toLocaleDateString("en-US", {
												year: "numeric",
												month: "long",
												day: "numeric",
											})}
										</time>
										<a
											href={`/posts/${post.slug}`}
											class="font-medium hover:text-zinc-100 transition-colors"
										>
											Read More â†’
										</a>
									</div>
								</div>
							</article>
						))}
					</div>
				) : (
					<div class="text-center py-12 border border-dashed border-zinc-700 rounded-lg">
						<p class="text-zinc-500">
							No posts yet. Check back soon!
						</p>
					</div>
				)
			}
		</section>
	</div>
</Layout>
